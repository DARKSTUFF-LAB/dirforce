#include <iostream>
#include <string>
#include <cstring>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <netdb.h>
#include <vector>
#include <thread>
#include <cstdlib>
#include <unistd.h>
#include <mutex>
#include <fstream>
#include <openssl/bio.h>
#include <openssl/ssl.h>
#include <openssl/err.h>
#include <iomanip>
#include <sstream>

using namespace std;

int wordlistcount;
ifstream wordlist;
int sslOption; //check if ssl is enabled
string host;
string address;
mutex wordlist_lock;
mutex progresslock;
int progressCounter = 0;
string percent;
string http_method;
int requestOption;
string readrequest;
string suffixe;
string preffixe;
string port;
string wordlistfile;
int threadCounter;
bool filterOption = false;
string filterStr;
bool liteOutput = false;
bool robotxtOption = true;
vector<string> extension;
string custom_header_str;

#include "progress.cpp"
#include "lineCounter.cpp"
#include "header_extractor.cpp"
#include "request.cpp"
#include "arguments.cpp"
#include "robotxt.cpp"

int main(int argc, char* argv[]) {
    arguments(argc, argv);
    wordlist.open(wordlistfile);
    wordlistcount = lineCounter(wordlistfile);
    if (!liteOutput) {
        cout << "[38;2;12;230;140m [39m[38;2;13;233;136m [39m[38;2;15;235;132m [39m[38;2;17;237;128m [39m[38;2;20;239;124m [39m[38;2;22;241;119m [39m[38;2;24;243;115mâ–ˆ[39m[38;2;27;245;111mâ–ˆ[39m[38;2;29;246;107m [39m[38;2;32;248;103mâ–ˆ[39m[38;2;35;249;98mâ–ˆ[39m[38;2;38;250;94m [39m[38;2;41;251;90m [39m[38;2;44;252;86m [39m[38;2;47;253;82m [39m[38;2;51;253;78m [39m[38;2;54;254;74m [39m[38;2;58;254;71m [39m[38;2;61;254;67m [39m[38;2;65;254;63m [39m[38;2;69;254;60m [39m[38;2;72;254;56mâ–ˆ[39m[38;2;76;254;53mâ–ˆ[39m[38;2;80;253;49mâ–ˆ[39m[38;2;84;253;46mâ–ˆ                            v0.2"
             << endl << "[38;2;17;237;128m [39m[38;2;20;239;124m [39m[38;2;22;241;119m [39m[38;2;24;243;115m [39m[38;2;27;245;111m [39m[38;2;29;246;107mâ–‘[39m[38;2;32;248;103mâ–ˆ[39m[38;2;35;249;98mâ–ˆ[39m[38;2;38;250;94mâ–‘[39m[38;2;41;251;90mâ–‘[39m[38;2;44;252;86m [39m[38;2;47;253;82m [39m[38;2;51;253;78m [39m[38;2;54;254;74m [39m[38;2;58;254;71m [39m[38;2;61;254;67m [39m[38;2;65;254;63m [39m[38;2;69;254;60m [39m[38;2;72;254;56m [39m[38;2;76;254;53m [39m[38;2;80;253;49mâ–‘[39m[38;2;84;253;46mâ–ˆ[39m[38;2;88;252;43mâ–ˆ[39m[38;2;92;251;40mâ–‘[39m[38;2;96;250;37m [39m[38;2;100;249;34m [39m[38;2;104;247;31m [39m[38;2;109;246;28m [39m[38;2;113;244;26m [39m[38;2;117;242;23m [39m[38;2;121;240;21m [39m[38;2;125;239;19m [39m[38;2;130;236;16m [39m[38;2;134;234;14m [39m[38;2;138;232;13m [39m[38;2;142;229;11m [39m[38;2;147;227;9m [39m[38;2;151;224;8m [39m[38;2;155;221;6m [39m[38;2;159;218;5m [39m[38;2;163;215;4m [39m[38;2;167;212;3m [39m[38;2;171;209;2m [39m[38;2;175;206;2m [39m[38;2;179;202;1m [39m[38;2;183;199;1m [39m[38;2;187;195;1m [39m[38;2;190;192;1m [39m[38;2;194;188;1m [39m[38;2;197;184;1m [39m[38;2;201;180;1m [39m[38;2;204;177;2m [39m[38;2;208;173;2m [39m[38;2;211;169;3m [39m[38;2;214;165;4m [39m[38;2;217;161;5m [39m[38;2;220;156;6m [39m[38;2;223;152;7m[39m"
             << endl << "[38;2;24;243;115m [39m[38;2;27;245;111m [39m[38;2;29;246;107m [39m[38;2;32;248;103m [39m[38;2;35;249;98m [39m[38;2;38;250;94mâ–‘[39m[38;2;41;251;90mâ–ˆ[39m[38;2;44;252;86mâ–ˆ[39m[38;2;47;253;82m [39m[38;2;51;253;78mâ–ˆ[39m[38;2;54;254;74mâ–ˆ[39m[38;2;58;254;71m [39m[38;2;61;254;67mâ–ˆ[39m[38;2;65;254;63mâ–ˆ[39m[38;2;69;254;60mâ–ˆ[39m[38;2;72;254;56mâ–ˆ[39m[38;2;76;254;53mâ–ˆ[39m[38;2;80;253;49mâ–ˆ[39m[38;2;84;253;46m [39m[38;2;88;252;43mâ–ˆ[39m[38;2;92;251;40mâ–ˆ[39m[38;2;96;250;37mâ–ˆ[39m[38;2;100;249;34mâ–ˆ[39m[38;2;104;247;31mâ–ˆ[39m[38;2;109;246;28mâ–ˆ[39m[38;2;113;244;26m [39m[38;2;117;242;23m [39m[38;2;121;240;21mâ–ˆ[39m[38;2;125;239;19mâ–ˆ[39m[38;2;130;236;16mâ–ˆ[39m[38;2;134;234;14mâ–ˆ[39m[38;2;138;232;13mâ–ˆ[39m[38;2;142;229;11mâ–ˆ[39m[38;2;147;227;9m [39m[38;2;151;224;8m [39m[38;2;155;221;6mâ–ˆ[39m[38;2;159;218;5mâ–ˆ[39m[38;2;163;215;4mâ–ˆ[39m[38;2;167;212;3mâ–ˆ[39m[38;2;171;209;2mâ–ˆ[39m[38;2;175;206;2mâ–ˆ[39m[38;2;179;202;1m [39m[38;2;183;199;1m [39m[38;2;187;195;1mâ–ˆ[39m[38;2;190;192;1mâ–ˆ[39m[38;2;194;188;1mâ–ˆ[39m[38;2;197;184;1mâ–ˆ[39m[38;2;201;180;1mâ–ˆ[39m[38;2;204;177;2m [39m[38;2;208;173;2m [39m[38;2;211;169;3m [39m[38;2;214;165;4mâ–ˆ[39m[38;2;217;161;5mâ–ˆ[39m[38;2;220;156;6mâ–ˆ[39m[38;2;223;152;7mâ–ˆ[39m[38;2;226;148;9mâ–ˆ[39m[38;2;228;144;10m [39m[38;2;231;140;12m[39m"
             << endl << "[38;2;32;248;103m [39m[38;2;35;249;98m [39m[38;2;38;250;94mâ–ˆ[39m[38;2;41;251;90mâ–ˆ[39m[38;2;44;252;86mâ–ˆ[39m[38;2;47;253;82mâ–ˆ[39m[38;2;51;253;78mâ–ˆ[39m[38;2;54;254;74mâ–ˆ[39m[38;2;58;254;71mâ–‘[39m[38;2;61;254;67mâ–ˆ[39m[38;2;65;254;63mâ–ˆ[39m[38;2;69;254;60mâ–‘[39m[38;2;72;254;56mâ–‘[39m[38;2;76;254;53mâ–ˆ[39m[38;2;80;253;49mâ–ˆ[39m[38;2;84;253;46mâ–‘[39m[38;2;88;252;43mâ–‘[39m[38;2;92;251;40mâ–ˆ[39m[38;2;96;250;37mâ–‘[39m[38;2;100;249;34mâ–‘[39m[38;2;104;247;31mâ–‘[39m[38;2;109;246;28mâ–ˆ[39m[38;2;113;244;26mâ–ˆ[39m[38;2;117;242;23mâ–‘[39m[38;2;121;240;21m [39m[38;2;125;239;19m [39m[38;2;130;236;16mâ–ˆ[39m[38;2;134;234;14mâ–ˆ[39m[38;2;138;232;13mâ–‘[39m[38;2;142;229;11mâ–‘[39m[38;2;147;227;9mâ–‘[39m[38;2;151;224;8mâ–‘[39m[38;2;155;221;6mâ–ˆ[39m[38;2;159;218;5mâ–ˆ[39m[38;2;163;215;4mâ–‘[39m[38;2;167;212;3mâ–‘[39m[38;2;171;209;2mâ–ˆ[39m[38;2;175;206;2mâ–ˆ[39m[38;2;179;202;1mâ–‘[39m[38;2;183;199;1mâ–‘[39m[38;2;187;195;1mâ–ˆ[39m[38;2;190;192;1m [39m[38;2;194;188;1mâ–ˆ[39m[38;2;197;184;1mâ–ˆ[39m[38;2;201;180;1mâ–‘[39m[38;2;204;177;2mâ–‘[39m[38;2;208;173;2mâ–‘[39m[38;2;211;169;3mâ–ˆ[39m[38;2;214;165;4mâ–ˆ[39m[38;2;217;161;5m [39m[38;2;220;156;6mâ–ˆ[39m[38;2;223;152;7mâ–ˆ[39m[38;2;226;148;9mâ–‘[39m[38;2;228;144;10mâ–‘[39m[38;2;231;140;12mâ–‘[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18m[39m"
             << endl << "[38;2;41;251;90m [39m[38;2;44;252;86mâ–ˆ[39m[38;2;47;253;82mâ–ˆ[39m[38;2;51;253;78mâ–‘[39m[38;2;54;254;74mâ–‘[39m[38;2;58;254;71mâ–‘[39m[38;2;61;254;67mâ–ˆ[39m[38;2;65;254;63mâ–ˆ[39m[38;2;69;254;60mâ–‘[39m[38;2;72;254;56mâ–ˆ[39m[38;2;76;254;53mâ–ˆ[39m[38;2;80;253;49m [39m[38;2;84;253;46mâ–‘[39m[38;2;88;252;43mâ–ˆ[39m[38;2;92;251;40mâ–ˆ[39m[38;2;96;250;37m [39m[38;2;100;249;34mâ–‘[39m[38;2;104;247;31m [39m[38;2;109;246;28m [39m[38;2;113;244;26m [39m[38;2;117;242;23mâ–‘[39m[38;2;121;240;21mâ–ˆ[39m[38;2;125;239;19mâ–ˆ[39m[38;2;130;236;16m [39m[38;2;134;234;14m [39m[38;2;138;232;13mâ–‘[39m[38;2;142;229;11mâ–ˆ[39m[38;2;147;227;9mâ–ˆ[39m[38;2;151;224;8m [39m[38;2;155;221;6m [39m[38;2;159;218;5m [39m[38;2;163;215;4mâ–‘[39m[38;2;167;212;3mâ–ˆ[39m[38;2;171;209;2mâ–ˆ[39m[38;2;175;206;2m [39m[38;2;179;202;1mâ–‘[39m[38;2;183;199;1mâ–ˆ[39m[38;2;187;195;1mâ–ˆ[39m[38;2;190;192;1m [39m[38;2;194;188;1mâ–‘[39m[38;2;197;184;1m [39m[38;2;201;180;1mâ–‘[39m[38;2;204;177;2mâ–ˆ[39m[38;2;208;173;2mâ–ˆ[39m[38;2;211;169;3m [39m[38;2;214;165;4m [39m[38;2;217;161;5mâ–‘[39m[38;2;220;156;6mâ–‘[39m[38;2;223;152;7m [39m[38;2;226;148;9mâ–‘[39m[38;2;228;144;10mâ–ˆ[39m[38;2;231;140;12mâ–ˆ[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18mâ–ˆ[39m[38;2;240;123;20mâ–ˆ[39m[38;2;242;119;22mâ–ˆ[39m[38;2;243;114;25m[39m"
             << endl << "[38;2;51;253;78mâ–‘[39m[38;2;54;254;74mâ–ˆ[39m[38;2;58;254;71mâ–ˆ[39m[38;2;61;254;67m [39m[38;2;65;254;63m [39m[38;2;69;254;60mâ–‘[39m[38;2;72;254;56mâ–ˆ[39m[38;2;76;254;53mâ–ˆ[39m[38;2;80;253;49mâ–‘[39m[38;2;84;253;46mâ–ˆ[39m[38;2;88;252;43mâ–ˆ[39m[38;2;92;251;40m [39m[38;2;96;250;37mâ–‘[39m[38;2;100;249;34mâ–ˆ[39m[38;2;104;247;31mâ–ˆ[39m[38;2;109;246;28m [39m[38;2;113;244;26m [39m[38;2;117;242;23m [39m[38;2;121;240;21m [39m[38;2;125;239;19m [39m[38;2;130;236;16mâ–‘[39m[38;2;134;234;14mâ–ˆ[39m[38;2;138;232;13mâ–ˆ[39m[38;2;142;229;11m [39m[38;2;147;227;9m [39m[38;2;151;224;8mâ–‘[39m[38;2;155;221;6mâ–ˆ[39m[38;2;159;218;5mâ–ˆ[39m[38;2;163;215;4m [39m[38;2;167;212;3m [39m[38;2;171;209;2m [39m[38;2;175;206;2mâ–‘[39m[38;2;179;202;1mâ–ˆ[39m[38;2;183;199;1mâ–ˆ[39m[38;2;187;195;1m [39m[38;2;190;192;1mâ–‘[39m[38;2;194;188;1mâ–ˆ[39m[38;2;197;184;1mâ–ˆ[39m[38;2;201;180;1m [39m[38;2;204;177;2m [39m[38;2;208;173;2m [39m[38;2;211;169;3mâ–‘[39m[38;2;214;165;4mâ–ˆ[39m[38;2;217;161;5mâ–ˆ[39m[38;2;220;156;6m [39m[38;2;223;152;7m [39m[38;2;226;148;9m [39m[38;2;228;144;10mâ–ˆ[39m[38;2;231;140;12mâ–ˆ[39m[38;2;233;136;14mâ–‘[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18mâ–ˆ[39m[38;2;240;123;20mâ–‘[39m[38;2;242;119;22mâ–‘[39m[38;2;243;114;25mâ–‘[39m[38;2;245;110;27mâ–‘[39m[38;2;247;106;30m [39m[38;2;248;102;33m[39m"
             << endl << "[38;2;61;254;67mâ–‘[39m[38;2;65;254;63mâ–‘[39m[38;2;69;254;60mâ–ˆ[39m[38;2;72;254;56mâ–ˆ[39m[38;2;76;254;53mâ–ˆ[39m[38;2;80;253;49mâ–ˆ[39m[38;2;84;253;46mâ–ˆ[39m[38;2;88;252;43mâ–ˆ[39m[38;2;92;251;40mâ–‘[39m[38;2;96;250;37mâ–ˆ[39m[38;2;100;249;34mâ–ˆ[39m[38;2;104;247;31mâ–‘[39m[38;2;109;246;28mâ–ˆ[39m[38;2;113;244;26mâ–ˆ[39m[38;2;117;242;23mâ–ˆ[39m[38;2;121;240;21m [39m[38;2;125;239;19m [39m[38;2;130;236;16m [39m[38;2;134;234;14m [39m[38;2;138;232;13m [39m[38;2;142;229;11mâ–‘[39m[38;2;147;227;9mâ–ˆ[39m[38;2;151;224;8mâ–ˆ[39m[38;2;155;221;6m [39m[38;2;159;218;5m [39m[38;2;163;215;4mâ–‘[39m[38;2;167;212;3mâ–‘[39m[38;2;171;209;2mâ–ˆ[39m[38;2;175;206;2mâ–ˆ[39m[38;2;179;202;1mâ–ˆ[39m[38;2;183;199;1mâ–ˆ[39m[38;2;187;195;1mâ–ˆ[39m[38;2;190;192;1mâ–ˆ[39m[38;2;194;188;1m [39m[38;2;197;184;1mâ–‘[39m[38;2;201;180;1mâ–ˆ[39m[38;2;204;177;2mâ–ˆ[39m[38;2;208;173;2mâ–ˆ[39m[38;2;211;169;3m [39m[38;2;214;165;4m [39m[38;2;217;161;5m [39m[38;2;220;156;6mâ–‘[39m[38;2;223;152;7mâ–‘[39m[38;2;226;148;9mâ–ˆ[39m[38;2;228;144;10mâ–ˆ[39m[38;2;231;140;12mâ–ˆ[39m[38;2;233;136;14mâ–ˆ[39m[38;2;236;131;16mâ–ˆ[39m[38;2;238;127;18m [39m[38;2;240;123;20mâ–‘[39m[38;2;242;119;22mâ–‘[39m[38;2;243;114;25mâ–ˆ[39m[38;2;245;110;27mâ–ˆ[39m[38;2;247;106;30mâ–ˆ[39m[38;2;248;102;33mâ–ˆ[39m[38;2;249;98;35mâ–ˆ[39m[38;2;250;94;38mâ–ˆ[39m[38;2;251;90;41m[39m"
             << endl << "[38;2;72;254;56m [39m[38;2;76;254;53mâ–‘[39m[38;2;80;253;49mâ–‘[39m[38;2;84;253;46mâ–‘[39m[38;2;88;252;43mâ–‘[39m[38;2;92;251;40mâ–‘[39m[38;2;96;250;37mâ–‘[39m[38;2;100;249;34m [39m[38;2;104;247;31mâ–‘[39m[38;2;109;246;28mâ–‘[39m[38;2;113;244;26m [39m[38;2;117;242;23mâ–‘[39m[38;2;121;240;21mâ–‘[39m[38;2;125;239;19mâ–‘[39m[38;2;130;236;16m [39m[38;2;134;234;14m [39m[38;2;138;232;13m [39m[38;2;142;229;11m [39m[38;2;147;227;9m [39m[38;2;151;224;8m [39m[38;2;155;221;6mâ–‘[39m[38;2;159;218;5mâ–‘[39m[38;2;163;215;4m [39m[38;2;167;212;3m [39m[38;2;171;209;2m [39m[38;2;175;206;2m [39m[38;2;179;202;1mâ–‘[39m[38;2;183;199;1mâ–‘[39m[38;2;187;195;1mâ–‘[39m[38;2;190;192;1mâ–‘[39m[38;2;194;188;1mâ–‘[39m[38;2;197;184;1mâ–‘[39m[38;2;201;180;1m [39m[38;2;204;177;2m [39m[38;2;208;173;2mâ–‘[39m[38;2;211;169;3mâ–‘[39m[38;2;214;165;4mâ–‘[39m[38;2;217;161;5m [39m[38;2;220;156;6m [39m[38;2;223;152;7m [39m[38;2;226;148;9m [39m[38;2;228;144;10m [39m[38;2;231;140;12mâ–‘[39m[38;2;233;136;14mâ–‘[39m[38;2;236;131;16mâ–‘[39m[38;2;238;127;18mâ–‘[39m[38;2;240;123;20mâ–‘[39m[38;2;242;119;22m [39m[38;2;243;114;25m [39m[38;2;245;110;27m [39m[38;2;247;106;30mâ–‘[39m[38;2;248;102;33mâ–‘[39m[38;2;249;98;35mâ–‘[39m[38;2;250;94;38mâ–‘[39m[38;2;251;90;41mâ–‘[39m[38;2;252;86;45mâ–‘[39m[38;2;253;82;48m [39m[38;2;254;78;51m[39m\n";
    
        cout << " Created by Guendouz Aimed \n youtube: www.youtube.com/@code0109 \n instagram: www.instagram.com/cod_e010\n";
        cout << "=========================================================\n\n"
             << "url : " << host << address << endl 
             << "wordlist : " << wordlistfile << " line : " << wordlistcount * extension.size() << endl 
             << "http method : " << http_method << "\n"
             << "thread : " << threadCounter << "\n"
             << "extension : ";
        for (auto& e : extension) {
            cout << ", " << e;
        }
        cout << "\n\n=========================================================\n\n";
    }

    vector<thread> threads;
    cout << "\033[1;37m[-] brute-forcing directory: \n\033[0;37m";
    // Resolve the host name to an IP address
    struct addrinfo hints = {0};
    hints.ai_family = AF_INET;
    hints.ai_socktype = SOCK_STREAM;
    struct addrinfo* result;
    if (sslOption == 1) port = "443"; else port = "80";
    int rc = getaddrinfo(host.c_str(), port.c_str(), &hints, &result);
    if (rc != 0) {
        std::cerr << "Error resolving hostname " << gai_strerror(rc) << "   " << port << host << std::endl;
        exit(1);
        return -1;
    }
    stringstream output;
    output << left << setw(8) << setfill(' ') << "status" << setw(custom_header_str.size() + 2) << setfill(' ') <<  custom_header_str << setw(15) << setfill(' ') << "path" << setw(15) << setfill(' ') << "redirect\n";
    cout << output.str() << endl;
    for (int i = 0; i < threadCounter; i++) {
        threads.emplace_back([&] {request(result->ai_addr, result->ai_addrlen);});
    }

    for(auto& t : threads) {
        t.join();
    }

    if (robotxtOption)
        robotxt(host, sslOption);

    printf("\n\n\t\033[1;31mscaning completed");
    return 0;
}